<div class="supplements-container">
  <div class="supplements-header">
    <div class="tabs">
      <button class="tab" [class.active]="activeTab() === 'add'" (click)="switchTab('add')">
        ‚ûï Add Supplement Entry
      </button>
      <button class="tab" [class.active]="activeTab() === 'show'" (click)="switchTab('show')">
        üìã View Entries
        @if (entries.length > 0) {
          <span class="tab-badge">{{ entries.length }}</span>
        }
      </button>
    </div>
    @if (activeTab() === 'show' && entries.length > 0) {
      <div class="total-display">
        <span class="total-label">Total:</span>
        <span class="total-amount">‚Çπ {{ totalAmount().toFixed(2) }}</span>
      </div>
    }
  </div>

  @if (activeTab() === 'add') {
    <div class="add-entry-form">
      <div class="form-grid">
        <div class="form-field">
          <label>Date <span class="required">*</span></label>
          <input type="date" [ngModel]="form().date" (ngModelChange)="update('date', $event)" required />
        </div>
        <div class="form-field">
          <label>Farmer ID <span class="required">*</span></label>
          <input
            type="text"
            list="farmer-list"
            placeholder="Enter Farmer ID or select from list"
            [ngModel]="form().farmerId"
            (ngModelChange)="onFarmerIdChange($event)"
            required />
          <datalist id="farmer-list">
            @for (customer of customers; track customer.farmerId) {
              <option [value]="customer.farmerId">{{ customer.farmerName }} ({{ customer.farmerId }})</option>
            }
          </datalist>
        </div>
        <div class="form-field">
          <label>Farmer Name</label>
          <input type="text" [ngModel]="form().farmerName" (ngModelChange)="update('farmerName', $event)" readonly />
        </div>
        <div class="form-field">
          <label>Supplement Type <span class="required">*</span></label>
          <select [ngModel]="form().supplementType" (ngModelChange)="update('supplementType', $event)" required>
            <option value="">-- Select Type --</option>
            @for (type of supplementTypes; track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>
        </div>
        <div class="form-field">
          <label>Quantity <span class="required">*</span></label>
          <input type="number" min="0" step="0.01" placeholder="0.00" [ngModel]="form().quantity" (ngModelChange)="update('quantity', $event)" required />
        </div>
        <div class="form-field">
          <label>Unit</label>
          <select [ngModel]="form().unit" (ngModelChange)="update('unit', $event)">
            <option value="kg">kg</option>
            <option value="g">g</option>
            <option value="L">L</option>
            <option value="mL">mL</option>
            <option value="pieces">pieces</option>
          </select>
        </div>
        <div class="form-field">
          <label>Rate (‚Çπ per unit) <span class="required">*</span></label>
          <input type="number" min="0" step="0.01" placeholder="0.00" [ngModel]="form().rate" (ngModelChange)="update('rate', $event)" required />
        </div>
        <div class="form-field">
          <label>Amount (‚Çπ)</label>
          <input type="number" [ngModel]="form().amount" readonly />
        </div>
        <div class="form-field full-width">
          <label>Description</label>
          <input type="text" placeholder="Description (optional)" [ngModel]="form().description" (ngModelChange)="update('description', $event)" />
        </div>
      </div>

      <div class="form-actions">
        <button class="btn-primary" (click)="onSave()">üíæ Save Entry</button>
        <button class="btn-secondary" (click)="reset()">üîÑ Reset</button>
      </div>
    </div>
  } @else {
    <div class="entries-container">
      @if (entries.length > 0) {
        <div class="table-wrapper">
          <table class="entries-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Farmer ID</th>
                <th>Farmer Name</th>
                <th>Type</th>
                <th>Quantity</th>
                <th>Rate</th>
                <th>Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (entry of entries; track entry.id) {
                <tr>
                  <td>{{ formatDate(entry.date) }}</td>
                  <td><strong>{{ entry.farmerId }}</strong></td>
                  <td>{{ entry.farmerName || getCustomerName(entry.farmerId) || '-' }}</td>
                  <td>{{ entry.supplementType }}</td>
                  <td>{{ entry.quantity }} {{ entry.unit }}</td>
                  <td>{{ formatCurrency(entry.rate) }}</td>
                  <td><strong>{{ formatCurrency(entry.amount) }}</strong></td>
                  <td>
                    <button class="btn-delete" (click)="onDelete(entry.id)" title="Delete">üóëÔ∏è</button>
                  </td>
                </tr>
              }
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="6"><strong>Total</strong></td>
                <td><strong>{{ formatCurrency(totalAmount()) }}</strong></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      } @else {
        <div class="empty-state">
          <p>No supplement entries found.</p>
        </div>
      }
    </div>
  }
</div>
